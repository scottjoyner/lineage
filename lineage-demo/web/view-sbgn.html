<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lineage – SBGN Style</title>
  <link rel="stylesheet" href="/assets/styles.css"/>
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/cytoscape-sbgn-stylesheet@4.0.0/cytoscape-sbgn-stylesheet.js"></script>
  <script src="/assets/common.js"></script>
</head>
<body>
<div class="wrap">

  <header>
    <h1>Lineage – SBGN Style</h1>
    <nav class="nav">
      <a href="/index.html">Explorer</a>
      <a href="/view-dagre.html">DAG (dagre)</a>
      <a href="/view-cose-bilkent.html">Large (cose-bilkent)</a>
      <a href="/view-sbgn.html">SBGN</a>
      <a href="/view-grid.html">Level Grid</a>
    </nav>
  </header>

  <div class="panel">
    <h2>Controls</h2>
    <div class="row">
      <label><input type="radio" name="mode" value="pde" checked> PDE</label>
      <label><input type="radio" name="mode" value="site"> Website</label>
    </div>
    <div class="row"><label style="min-width:80px">Key</label><input id="key" style="flex:1" placeholder="dw.orders_fact.amount_usd"/></div>
    <div class="row"><label style="min-width:80px">Hops</label><input id="hops" type="number" value="5" min="1" max="10" style="width:90px"/></div>
    <div class="row"><label style="min-width:80px">API</label><input id="api" style="flex:1"/></div>
    <div class="row">
      <button id="load" class="primary">Load</button>
      <button id="fit">Fit</button>
      <button id="png">Export PNG</button>
    </div>
    <h2>Legend</h2>
    <div id="legend" class="legend"></div>
    <hr>
    <div class="hint">SBGN stylesheet provides a clean, high-contrast systems-biology look; here we map our types to SBGN-like glyphs.</div>
  </div>
  <div class="panel" style="grid-column:2;grid-row:2"><div id="cy" style="width:100%;height:100%"></div></div>
</div>
<script>
(function(){
  const apiIn = document.getElementById('api'); apiIn.value = defaultApi();
  const keyIn = document.getElementById('key'); keyIn.value = 'dw.orders_fact.amount_usd';
  const hopsIn = document.getElementById('hops');
  const modeRadios = [...document.querySelectorAll('input[name="mode"]')];
  buildLegend(document.getElementById('legend'));

  // Base + SBGN
  const sbgnStyle = cytoscapeSbgnStylesheet(cytoscape);
  const cy = cytoscape({
    container: document.getElementById('cy'),
    elements: [],
    // Merge SBGN style with our colors/labels
    style: sbgnStyle.concat(baseStyle()),
    layout: { name: 'concentric', minNodeSpacing: 30, concentric: n => n.data('type') === 'PDE' ? 3 : 1, levelWidth: () => 2, fit:true }
  });

  document.getElementById('load').addEventListener('click', async () => {
    const mode = modeRadios.find(r=>r.checked)?.value || 'pde';
    await loadGraph(cy, apiIn.value, mode, keyIn.value, parseInt(hopsIn.value,10)||4);
    cy.layout({ name:'concentric', minNodeSpacing:30, fit:true }).run();
  });
  document.getElementById('fit').addEventListener('click', ()=> cy.fit());
  document.getElementById('png').addEventListener('click', ()=> exportPng(cy));

  document.getElementById('load').click();
})();
</script>
</body>
</html>
