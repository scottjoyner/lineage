<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lineage – Large Graph (cose-bilkent)</title>
  <link rel="stylesheet" href="/assets/styles.css"/>
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://unpkg.com/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.js"></script>
  <script src="/assets/common.js"></script>
</head>
<body>
<div class="wrap">

  <header>
    <h1>Lineage – Large Graph (cose-bilkent)</h1>
    <nav class="nav">
      <a href="/index.html">Explorer</a>
      <a href="/view-dagre.html">DAG (dagre)</a>
      <a href="/view-cose-bilkent.html">Large (cose-bilkent)</a>
      <a href="/view-sbgn.html">SBGN</a>
      <a href="/view-grid.html">Level Grid</a>
    </nav>
  </header>

  <div class="panel">
    <h2>Controls</h2>
    <div class="row">
      <label><input type="radio" name="mode" value="pde" checked> PDE</label>
      <label><input type="radio" name="mode" value="site"> Website</label>
    </div>
    <div class="row"><label style="min-width:80px">Key</label><input id="key" style="flex:1" placeholder="orders.example.com"/></div>
    <div class="row"><label style="min-width:80px">Hops</label><input id="hops" type="number" value="6" min="1" max="10" style="width:90px"/></div>
    <div class="row"><label style="min-width:80px">API</label><input id="api" style="flex:1"/></div>
    <div class="row">
      <button id="load" class="primary">Load</button>
      <button id="fit">Fit</button>
      <button id="png">Export PNG</button>
      <button id="json">Export JSON</button>
    </div>
    <h2>Legend</h2>
    <div id="legend" class="legend"></div>
    <hr>
    <div class="hint">COSE-Bilkent excels on larger graphs with compound springs; tweak quality & gravity for big lineages.</div>
  </div>
  <div class="panel" style="grid-column:2;grid-row:2"><div id="cy" style="width:100%;height:100%"></div></div>
</div>
<script>
(function(){
  const apiIn = document.getElementById('api'); apiIn.value = defaultApi();
  const keyIn = document.getElementById('key'); keyIn.value = 'orders.example.com';
  const hopsIn = document.getElementById('hops');
  const modeRadios = [...document.querySelectorAll('input[name="mode"]')];
  buildLegend(document.getElementById('legend'));

  const cy = cytoscape({
    container: document.getElementById('cy'),
    elements: [],
    style: baseStyle(),
    layout: { name: 'cose-bilkent', animate: 'end', randomize: true, fit: true, idealEdgeLength: 100, nodeRepulsion: 5000, gravity: 0.25, numIter: 2500 }
  });

  document.getElementById('load').addEventListener('click', async () => {
    const mode = modeRadios.find(r=>r.checked)?.value || 'pde';
    await loadGraph(cy, apiIn.value, mode, keyIn.value, parseInt(hopsIn.value,10)||4);
    cy.layout({ name: 'cose-bilkent', animate:'end', fit:true, idealEdgeLength: 100, nodeRepulsion: 5000, gravity: 0.25, numIter: 2500 }).run();
  });
  document.getElementById('fit').addEventListener('click', ()=> cy.fit());
  document.getElementById('png').addEventListener('click', ()=> exportPng(cy));
  document.getElementById('json').addEventListener('click', ()=> exportJson(cy));
  document.getElementById('load').click();
})();
</script>
</body>
</html>
